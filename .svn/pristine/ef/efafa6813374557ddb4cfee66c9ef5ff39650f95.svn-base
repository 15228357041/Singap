package com.mingcloud.proxy.logiclayer.beiqidisposeouthandler;

import com.mingcloud.proxy.datacenter.DataCenter;
import com.mingcloud.proxy.datacenter.SIFATransferData;
import com.mingcloud.proxy.datalayer.dao.archiveinfo.CommonrecodeexMapper;
import com.mingcloud.proxy.datalayer.dto.archiveinfo.CommonrecodeexDto;
import com.mingcloud.proxy.datalayer.entity.archiveinfo.CommonrecodeexEntity;
import com.mingcloud.proxy.datalayer.entity.archiveinfo.SIFATransferEntity;
import com.mingcloud.proxy.util.SpringContextUtil;
import org.apache.log4j.Logger;
import org.springframework.transaction.annotation.Transactional;

import java.text.SimpleDateFormat;
import java.util.List;



/*
 * 北汽输出线程
 */
public class BeiqiDisposeDoutDataOutThread implements Runnable {
	private static Logger logger = Logger.getLogger(BeiqiDisposeDoutDataOutThread.class);

	private static SIFATransferData sIFATransferData = SIFATransferData.getInstance();
	
	private CommonrecodeexMapper commonrecodeexMapper =
			SpringContextUtil.getBean("commonrecodeexMapper");
	
	private DataCenter dataCenter = DataCenter.getInstance();
	
	private SimpleDateFormat sdf = new SimpleDateFormat("yyyyMMdd");
	
	public void run() {
		while(true){
			if (dataCenter.getWeatherCommonrecodeexlistSize() > 0) {
				InsertCommonrecodeex();
				logger.info("BeiqiDataCenter size: " + dataCenter.getWeatherCommonrecodeexlistSize());
			}
			try {
				Thread.sleep(1000);
			} catch (InterruptedException e) {
				logger.error("BeiqiDataOutThread: " + e);
			}
		}
	}

	@Transactional
	private void InsertCommonrecodeex(){
		try {
			CommonrecodeexEntity commonrecodeexentity = new CommonrecodeexEntity();
			if (dataCenter.getWeatherCommonrecodeexlistSize() > 0){
				CommonrecodeexDto dto = dataCenter.popWeatherCommonrecodeexlist();
				commonrecodeexentity.setExtravarchar1(dto.getExtravarchar1());				
				List <CommonrecodeexEntity> list = commonrecodeexMapper.select(commonrecodeexentity);
				SIFATransferEntity en = new SIFATransferEntity();
				
//				curdto.setExtravarchar1(checkOutParameter(entit.getANLABUKRS())); // 公司代码
//				curdto.setExtravarchar2(checkOutParameter(entit.getANLAANLN1())); // 资产编号
//				curdto.setExtravarchar3(checkOutParameter(entit.getSYDATUM())); // 资产报废日期
//				curdto.setExtravarchar4(checkOutParameter(entit.getSYDATUM1())); // 更改日期
//				curdto.setExtravarchar5(checkOutParameter(entit.getANEPANBTR()));//资产净值
            	
            	en.setAssetkey(dto.getExtravarchar2());
            	if(dto.getExtravarchar5()!=null) {
            		en.setOriginalvalue(Double.valueOf(dto.getExtravarchar5()));
            	}
            	if(dto.getExtravarchar3()!=null) {
            		en.setExtravarchar4(dto.getExtravarchar3());
            	}
            	if(dto.getExtravarchar4()!=null) {
            		en.setExtradatetime5(sdf.parse(dto.getExtravarchar4()));
            	}
            	System.out.println("assetkey:"+en.getAssetkey()+",extravarchar4:"+en.getExtravarchar4()+",extradatetime5:"
            			+en.getExtradatetime5()+",netvalue:"+en.getOriginalvalue());
            	if(dto.getExtravarchar2()==null) {
            		logger.info("BeiqiDataOutThread.UesLessData ");
            	}else {
            		sIFATransferData.updateSIFATransfer(en);//update
            		logger.info("BeiqiDataOutThread.updateCommonrecodeexSucced ");
            	}
			}
		} catch (Exception e) {  
			logger.error("BeiqiDataOutThread.InsertCommonrecodeex: " + e);
        }
	}
	
}
