package com.mingcloud.proxy.logiclayer.beiqifamdhandler;

import com.mingcloud.proxy.datacenter.BeiqiTransferData;
import com.mingcloud.proxy.datacenter.DataCenter;
import com.mingcloud.proxy.datalayer.dto.archiveinfo.CommonrecodeexDto;
import com.mingcloud.proxy.datalayer.entity.archiveinfo.BeiqiTransferEntity;
import org.apache.log4j.Logger;

import java.util.List;



/*
 * 北汽导入线程
 */
public class BeiqiFamdOutDataInThread implements Runnable {
	private static Logger logger = Logger.getLogger(BeiqiFamdOutDataInThread.class);
	
	private DataCenter dataCenter = DataCenter.getInstance();
	
	private static BeiqiTransferData beiqiTransferData =BeiqiTransferData.getInstance();
	
	public void run() {
		while(true) {	
			try {
	            if (dataCenter.getWeatherCommonrecodeexlistSize() <= 100) {
	            	logger.info("BeiqiDataInThread running...");
					GetAllBeiqiTransferData();
				} 
				logger.info("BeiqiDataInThread wait for 5 minutes...");
				Thread.sleep(5 * 60 * 1000);
			} catch (InterruptedException e) {
				logger.error("BeiqiDataInThread: " + e);
			}
		}
	}
	
	public void GetAllBeiqiTransferData() {
		beiqiTransferData.resetBeiqiTransferList();
		List<BeiqiTransferEntity> list = beiqiTransferData.getBeiqiTransferList();
		try {
			if (list != null && !list.isEmpty()) {
				for (BeiqiTransferEntity curentity : list) {
					if( createCardCheck(curentity.getRootmoid(),curentity.getPoskey())) {
						logger.info("BeiqiDataInThread.Rootmodi:"+curentity.getRootmoid()+",PosKey:"+curentity.getPoskey());
						continue;
					}
					CommonrecodeexDto curdto = new CommonrecodeexDto();
					curdto.setExtravarchar1(curentity.getMokey());
					curdto.setExtravarchar2(curentity.getExtravarchar18());
					curdto.setExtravarchar3(curentity.getMoname());
					curdto.setExtravarchar4(curentity.getExtramoinfo1());
					curdto.setExtravarchar5(curentity.getCostcenterkey1());
					curdto.setExtravarchar6(curentity.getExtravarchar20());
					curdto.setExtravarchar7(curentity.getCostcenterkey2());
					curdto.setExtravarchar8(curentity.getContractno());
					System.out.println(curentity.toString());
					dataCenter.pushWeatherCommonrecodeexlist(curdto);
					logger.info("BeiqiDataInThread.GetBeiqiTransferData succeeded...");
				}
			}
		} catch (Exception e) {
			logger.error("BeiqiDataInThread.GetAllBeiqiData(): " + e);
		}
	}
	
	private boolean createCardCheck(String rootmodid,String poskey) {
		if((rootmodid==null && poskey==null) || (rootmodid!=null && poskey!=null)) {
			return true;
		}
		if(rootmodid!=null || poskey==null) {
			return true;
		}
		return false;
	}
}
